$(document).ready(function(){var c=$("#portalid"),a=$("#submit-btn");null!=c.val()?(SearchPortalUsers(1),populateOrganisations()):a.prop("disabled",!0);c.change(function(){populateOrganisations();a.prop("disabled",!1)});$("#impersonate").on("show.bs.modal",function(c){var a=$(c.relatedTarget).data("user-id"),b=$(c.relatedTarget).data("portal-id");$("#impersonate-btn").prop("disabled",!0);$.when(AjaxCheckAccountLock(a)).then(function(b){$("#impersonate-btn").prop("disabled",!1);"true"==b.status&&$("#account-locked").show()});
$("#impersonate-btn").off().on("click",function(){window.location.replace("/adminusers/ImpersonateUser/"+a+"?portalid="+b)})});$("#impersonate").on("hide.bs.modal",function(c){$("#account-locked").css("display","none")})});function AjaxCheckAccountLock(c){return $.ajax({url:"/adminusers/ajaxCheckAccountLock",type:"post",dataType:"json",cache:!1,data:"userId="+c})}function advancedSearch(){$("#advanced-search").toggle()}
function SearchPortalUsers(c){var a=new AjaxPortalUsers;a.setPageNumber(c);a.setPostData($("#user-search-form").serialize());$("#user-search-results").css("opacity",.4);$.when(a.fetch()).then(function(c){$("#no-results").css("display","none");$("#no-results-found").css("display","none");$("#user-search-results").empty();$("#user-search-results").css("opacity",1);0<c.items.length&&($.each(c.items,function(c,b){var a="<tr><td>"+b.image+'</td><td><a href="/adminusers/viewuser/'+b.userId+'">'+b.firstname+
" "+b.lastname+'</a></td><td class="hidden-xs"><a href="/adminusers/viewuser/'+b.userId+'">'+b.reference+'</a></td><td class="hidden-xs">'+b.email+'</td><td class="hidden-xs"><a href="/adminorgs/view/'+b.organisationId+'">'+b.organisationName+'</a></td><td class="hidden-xs">'+b.role+"</td><td>"+b.registrationState+"</td>";1==b.impersonate?(a=a+"<td>"+('<a href="#" data-target="#impersonate" data-toggle="modal" data-user-id="'+b.userId+'" data-portal-id="'+b.portalId+'">'),a+='<span class="label label-success label-lg" title="Active"><i class="fa fa-power-off"></i></span>',
a+="</a></td>"):a+="<td></td>";a+="</tr>";$("#user-search-results").append(a)}),Pagination(c,"SearchPortalUsers",$("#user-pagination")))})}
function populateOrganisations(){var c=$("#organisationId");c.prop("disabled",!0);c.html('<option selected value="All">All</option>');var a=new AjaxGetPortalOrganisations;a.setPortalId($("#portalid").val());$.when(a.fetch()).then(function(a){c.prop("disabled",!1);$.each(a,function(a,b){c.val()==b.organisationId?$("#organisationId").append('<option selected value="'+b.organisationId+'">'+b.organisationName+"</option>"):$("#organisationId").append('<option value="'+b.organisationId+'">'+b.organisationName+
"</option>")})})};
