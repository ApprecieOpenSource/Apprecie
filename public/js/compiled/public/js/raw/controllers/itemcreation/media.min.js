var videoDetails=[];
$(document).ready(function(){var a=$("#picture-error"),c=$("#upload-image-button");$(".carousel").carousel({interval:!1});c.click(function(){a.fadeOut();var b=new FileUpload;b.setFileInput($("#image-file"));b.validateFile();b.validateImageType();0<b.errors.length?(a.html(b.getErrorHTML()),a.fadeIn()):($(this).prop("disabled",!0).html('<img src="/img/ajax-loader.gif"/> Uploading...'),$("#picture-form").submit())});$("#image-file").on("change",function(){a.fadeOut();var b=new FileUpload;b.setFileInput($("#image-file"));
b.validateFile();b.validateImageType();0<b.errors.length?(a.html(b.getErrorHTML()),a.fadeIn(),c.prop("disabled",!0)):c.prop("disabled",!1)});$("#picture-iframe").load(function(){a.fadeOut();if(""!=$("#picture-iframe").contents().text()){var b=$.parseJSON($("#picture-iframe").contents().text());"success"==b.status?window.location=window.location.href:(a.html(b.message),c.prop("disabled",!1).html("Upload"),a.fadeIn())}});$(".image-container").hover(function(){$(this).find(".image-container-hover").show()},
function(){$(this).find(".image-container-hover").hide()});$("#video-type").change(function(){$("#upload-video-button").prop("disabled",!0);$("#video-error").stop().hide();$("#video-success").stop().hide();$("#youtube-link-container").hide();$("#youtube-link-iframe").attr("src","").hide();$("#vimeo-link-container").hide();$("#vimeo-link-iframe").attr("src","").hide();switch($("#video-type").val()){case "youtube":$("#youtube-link-container").show();break;case "vimeo":$("#vimeo-link-container").show()}});
$("#youtube-video-id").on("input",function(){$("#upload-video-button").prop("disabled",!0);$("#video-error").stop().hide();$("#video-success").stop().hide();$("#youtube-link-iframe").attr("src","").hide()});$("#vimeo-video-id").on("input",function(){$("#upload-video-button").prop("disabled",!0);$("#video-error").stop().hide();$("#video-success").stop().hide();$("#vimeo-link-iframe").attr("src","").hide()})});
$(function(){$("#sortable").sortable({placeholder:"ui-state-highlight"});$("#sortable").disableSelection();$("#sortable").on("sortupdate",function(){var a=[];$(this).find(".sortable-img").each(function(){a.push($(this).attr("id"))});$.when(AjaxUpdateOrder(a)).then(function(){$("#order-update-message").stop().fadeOut("fast").fadeIn("fast")})})});function deleteMedia(a){new OverlayMessage("Reloading, please wait...");$.when(AjaxDeleteMedia(a)).then(function(){location.reload()})}
function AjaxUpdateOrder(a){return $.ajax({url:"/itemcreation/ajaxUpdateOrder/"+itemId,type:"post",dataType:"json",cache:!1,data:{images:a,CSRF_SESSION_TOKEN:CSRF_SESSION_TOKEN}})}function AjaxDeleteMedia(a){return $.ajax({url:"/itemcreation/AjaxDeleteMedia/"+a,type:"post",dataType:"json",data:{CSRF_SESSION_TOKEN:CSRF_SESSION_TOKEN}})}
function AddVideo(){$("#video-error").stop().hide();$("#upload-video-button").prop("disabled",!0);$.when(AjaxAddVideo()).then(function(a){$("#upload-video-button").prop("disabled",!1);location.reload()})}function AjaxAddVideo(){return $.ajax({url:"/itemcreation/addvideo/"+itemId,type:"post",contentType:"application/x-www-form-urlencoded",data:videoDetails})}
function getVideo(){videoDetails={};$("#video-success").stop().hide();$("#video-error").stop().hide();$("#validate-video").prop("disabled",!0);switch($("#video-type").val()){case "youtube":$.when(AjaxGetYoutubeVideo($("#youtube-video-id").val())).then(function(a){0==a.items.length?($("#video-error").stop().fadeOut("fast").empty().html("Invalid video ID").fadeIn("fast"),$("#youtube-link-iframe").attr("src","").hide()):($("#video-success").stop().fadeIn("fast"),$("#youtube-link-iframe").attr("src",
"https://www.youtube.com/embed/"+a.items[0].id).show(),$("#upload-video-button").prop("disabled",!1),videoDetails.type="youtube",videoDetails.id=a.items[0].id,thumbnail=null!=a.items[0].snippet.thumbnails.maxres?a.items[0].snippet.thumbnails.maxres.url:null!=a.items[0].snippet.thumbnails.standard?a.items[0].snippet.thumbnails.standard.url:a.items[0].snippet.thumbnails.medium.url,videoDetails.thumbnail=thumbnail);$("#validate-video").prop("disabled",!1)},function(a){$("#video-error").stop().fadeOut("fast").empty().html("Failed to contact Youtube").fadeIn("fast");
$("#link-iframe").attr("src","").hide()});break;case "vimeo":$.when(AjaxGetVimeoVideo($("#vimeo-video-id").val())).then(function(a){$("#video-success").stop().fadeIn("fast");$("#vimeo-link-iframe").attr("src","https://player.vimeo.com/video/"+a.video_id).show();$("#upload-video-button").prop("disabled",!1);$("#validate-video").prop("disabled",!1);videoDetails.type="vimeo";videoDetails.id=a.video_id;videoDetails.thumbnail=a.thumbnail_url},function(){$("#video-error").stop().fadeOut("fast").empty().html("Failed to contact Vimeo").fadeIn("fast");
$("#link-iframe").attr("src","").hide()})}}function AjaxGetYoutubeVideo(a){return $.ajax({url:"https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+a+"&key=AIzaSyAVzCW7rLklcCn7_FJRKtyLF2fsZxQEZyU",type:"get",dataType:"jsonp"})}function AjaxGetVimeoVideo(a){return $.ajax({url:"https://vimeo.com/api/oembed.json?url=https%3A//vimeo.com/"+a,type:"get",dataType:"jsonp"})};
