var vaultLoader=null,vaultPage=null,geocoder,geocodeResults=null,timer=null,resultView="#vaulttiles";
$(document).ready(function(){geocoder=new google.maps.Geocoder;var a=$("#pageContent");vaultLoader=new vaultSPA(null,"#vaultLoadIndicator","doneLoading");$("#resetData").click(function(){$("#searchFiltersContainer").fadeOut(1E3);$("#vaultImageBanner").fadeOut(1E3);a.empty();$("#interests-container").empty();$("#brands-container").empty();vaultLoader.reset()});$("#postcode").keyup(function(){""!=$(this).val()?($("#apply-filters").prop("disabled",!0),clearTimeout(timer),timer=setTimeout(function(){getGeolocation()},
800)):($("#georesults").empty(),$("#apply-filters").prop("disabled",!1),vaultLoader.setSearchLatLng(null,null),$(".distanceOrder").prop("disabled",!0),displayResults())});$("#order").change(function(){"distanceASC"==$(this).val()&&vaultLoader.setSort("distance",!1);"distanceDESC"==$(this).val()&&vaultLoader.setSort("distance",!0);"suggestionsDESC"==$(this).val()&&vaultLoader.setSort("suggestions",!0);"suggestionsASC"==$(this).val()&&vaultLoader.setSort("suggestions",!1);"eventDateDESC"==$(this).val()&&
vaultLoader.setSort("startDateTimeEpoc",!0);"eventDateASC"==$(this).val()&&vaultLoader.setSort("startDateTimeEpoc",!1);"priceASC"==$(this).val()&&vaultLoader.setSort("unitPrice",!1);"priceDESC"==$(this).val()&&vaultLoader.setSort("unitPrice",!0);displayResults()});$("#distance").change(function(){vaultLoader.setDistance($(this).val());displayResults()});$("#brands-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#brands-container").show();$(".selected-filter").removeClass("selected-filter");
$(this).addClass("selected-filter")});$("#interests-filter").click(function(){$(this).hasClass("option-disabled")||($("#filters-container").fadeIn("fast"),$(".filter-container").hide(),$("#interests-container").show(),$(".selected-filter").removeClass("selected-filter"),$(this).addClass("selected-filter"))});$("#price-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#price-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")});
$("#type-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#type-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")});$("#gender-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#gender-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")});$("#age-filter").click(function(){$(this).hasClass("option-disabled")||
($("#filters-container").fadeIn("fast"),$(".filter-container").hide(),$("#age-options").show(),$(".selected-filter").removeClass("selected-filter"),$(this).addClass("selected-filter"))});$("#people-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#people-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")})});
function doneLoading(){var a=$("#pageContent"),c=$.templates("#vaulttiles");vaultLoader.setSort("startDateTimeEpoc",!1);vaultPage=new Pager(vaultLoader.getItems(),6,1,"vaultPage",a,c,"bindTiles");$("#searchFiltersContainer").fadeIn(1E3);$("#vaultImageBanner").fadeIn(1E3);displayBrands();displayInterests()}
function displayResults(){var a=$("#pageContent");vaultLoader.setDistance($("#distance").val());if(0!=vaultLoader.getFilteredResults().length){var c=$.templates(resultView);vaultPage=new Pager({items:vaultLoader.getFilteredResults(),totalItems:vaultLoader.getFilteredResults().length},6,1,"vaultPage",a,c,"bindTiles")}else a.html('<div class="col-sm-12"><div class="alert alert-info" role="alert">We could not find any events that match your search criteria</div></div>')}
function displayBrands(){$.each(vaultLoader.getBrands(),function(){$("#brands-container").append('<div class="col-lg-3 col-md-4 col-md-6"><div class="alert alert-plain alert-thin link selectableItem" style="margin-bottom: 5px;" onclick="addOrFilter(\'brand\',\''+this.organisationId+'\')" id="brand'+this.organisationId+'">'+this.name+"</div></div>")})}
function displayInterests(){$.each(vaultLoader.getInterests(),function(){$("#interests-container").append('<div class="col-lg-3 col-md-4 col-md-6"><div class="alert alert-plain alert-thin link interest-opt selectableItem" style="margin-bottom: 5px;" id="interest'+this.interestId+"\" onclick=\"addOrFilter('interest','"+this.interestId+"')\">"+this.name+"</div></div>")})}
function resetFilters(){$(".selectableItem").removeClass("alert-success").addClass("alert-plain");vaultLoader.resetFilters();displayResults()}function bindTiles(){$(".item-tile").hover(function(){$(this).find(".item-tile-desc").stop().animate({height:"toggle"},200,function(){})},function(){$(this).find(".item-tile-desc").stop().animate({height:"toggle"},200,function(){})})}
function addXorFilter(a,c){var b=$("."+a),d=$("#"+a+c);d.hasClass("alert-success")?(b.removeClass("alert-success").addClass("alert-plain"),vaultLoader.addFilter(a,null)):(b.removeClass("alert-success").addClass("alert-plain"),d.removeClass("alert-plain").addClass("alert-success"),vaultLoader.addFilter(a,c));displayResults()}
function addSingleFilter(a,c){var b=$("#"+a+c);b.hasClass("alert-success")?(b.removeClass("alert-success").addClass("alert-plain"),vaultLoader.addFilter(a,null)):(b.removeClass("alert-plain").addClass("alert-success"),vaultLoader.addFilter(a,c));displayResults()}
function addOrFilter(a,c){var b=vaultLoader.getFilters()[a],d=$("#"+a+c);null==b&&(b=[]);d.hasClass("alert-success")?(d.removeClass("alert-success").addClass("alert-plain"),b.splice(b.indexOf(c),1)):(d.removeClass("alert-plain").addClass("alert-success"),b.push(c));vaultLoader.addFilter(a,b);displayResults()}function getBrowserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(geocodeLatLng):alert("Geolocation is not supported by this browser.")}
function getGeolocation(){if(""!=$("#postcode").val()){var a=$("#postcode").val();geocoder.geocode({address:a},function(a,b){b==google.maps.GeocoderStatus.OK?formatGeocodeResults(a):($("#georesults").empty(),$("#georesults").append('<div class="alert alert-warning" role="alert" style="margin-top:5px;">No results were found please refine your search</div>'))})}}
function geocodeLatLng(a){a={lat:parseFloat(a.coords.latitude),lng:parseFloat(a.coords.longitude)};geocoder.geocode({location:a},function(a,b){b===google.maps.GeocoderStatus.OK?($("#apply-filters").prop("disabled",!0),formatGeocodeResults(a)):($("#georesults").empty(),$("#georesults").append('<div class="alert alert-warning" role="alert" style="margin-top:5px;">No results were found please refine your search</div>'))})}
function formatGeocodeResults(a){$("#georesults").empty();var c=0;0<a.length&&(geocodeResults=a,$.each(a,function(a,d){c++;$("#georesults").append('<div class="georesult" onclick="setSearchLocation('+a+')">'+d.formatted_address+"</div>")}),0!=c?$("#georesults").prepend('<p style="margin-top: 15px; font-weight: bold">Please select a location:</p>'):($("#georesults").empty(),$("#georesults").append('<div class="alert alert-warning" role="alert" style="margin-top:5px;">No results were found please refine your search</div>')))}
function setSearchLocation(a){$("#apply-filters").prop("disabled",!1);vaultLoader.setSearchLatLng(geocodeResults[a].geometry.location.lat(),geocodeResults[a].geometry.location.lng());$("#postcode").val(geocodeResults[a].formatted_address);$("#georesults").empty();$(".distanceOrder").prop("disabled",!1);displayResults()}function setResultsView(a){resultView=a;displayResults()};
