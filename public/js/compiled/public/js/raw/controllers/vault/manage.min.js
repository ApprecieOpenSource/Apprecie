$(document).ready(function(){refreshGuestList()});function refreshGuestList(){getAttendingGuestList(1);getDeclinedGuestList(1);getInvitedGuestList(1)}
function getAttendingGuestList(e){var d=new GuestList;d.setPageNumber(e);d.setPostData({attending:"true",itemid:itemId,CSRF_SESSION_TOKEN:CSRF_SESSION_TOKEN});$.when(d.fetch()).then(function(c){var a="";$.each(c.items,function(c,b){a+="<tr><td>"+b.profile.firstname+" "+b.profile.lastname+"</td><td>"+b.reference+"</td><td>"+b.role+'</td><td><a href="mailto:'+b.profile.email+'">'+b.profile.email+'</a></td><td class="hidden-xs">'+b.confirmDate+'</td><td class="hidden-xs">'+b.status+'</td><td class="hidden-xs">'+
b.guest.spaces+"</td><td>";b.isOwner?!1===deniedForActions&&(a+='<div class="btn-group pull-right">',a+='<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Options <span class="caret"></span></button>',a+='<ul class="dropdown-menu" role="menu">',a+='<li><a style="cursor:pointer;" onclick="DeclineGuest('+b.guest.userId+')">Do not attend</a></li>',a+="</ul>",a+="</div>"):!1===b.userIsDeleted&&(a+='<div class="btn-group pull-right"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Options <span class="caret"></span></button><ul class="dropdown-menu" role="menu">',
a+='<li><a href="/people/viewuser/'+b.guest.userId+'">View profile</a></li>',!1===deniedForActions&&(a+='<li><a style="cursor:pointer;" onclick="DeclineGuest('+b.guest.userId+')">Change to Declined</a></li>'),a+="</ul></div>");a+="</td></tr>"});0==c.items.length&&(a='<tr><td colspan="8">'+c.message+"</td></tr>");$("#attending-count").html(c.spaceCount);$("#attending-tbl").html(a);Pagination(c,"getAttendingGuestList",$("#attending-pagination"))})}
function getDeclinedGuestList(e){var d=new GuestList;d.setPageNumber(e);d.setPostData({attending:"false",itemid:itemId,status:["declined","revoked","cancelled"],CSRF_SESSION_TOKEN:CSRF_SESSION_TOKEN});$.when(d.fetch()).then(function(c){var a="";$.each(c.items,function(c,b){a+="<tr><td>"+b.profile.firstname+" "+b.profile.lastname+"</td><td>"+b.reference+"</td><td>"+b.role+'</td><td><a href="mailto:'+b.profile.email+'">'+b.profile.email+'</a></td><td class="hidden-xs">'+b.confirmDate+'</td><td class="hidden-xs">'+
b.status+'</td><td class="hidden-xs">'+b.guest.spaces+"</td><td>";b.isOwner?!1===deniedForActions&&(a+='<div class="btn-group pull-right"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Options <span class="caret"></span></button><ul class="dropdown-menu" role="menu">',a+='<li><a style="cursor:pointer;" onclick="AttendGuest('+b.guest.userId+')">Change to Attending</a></li>',a+='<li><a style="cursor:pointer;" onclick="ShowPreview('+b.guest.userId+
", "+b.guest.spaces+')">Resend Invitation</a></li>',a+="</ul></div>"):!1===b.userIsDeleted&&(a+='<div class="btn-group pull-right"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Options <span class="caret"></span></button><ul class="dropdown-menu" role="menu">',a+='<li><a href="/people/viewuser/'+b.guest.userId+'">View profile</a></li>',!1===deniedForActions&&(a+='<li><a style="cursor:pointer;" onclick="AttendGuest('+b.guest.userId+')">Change to Attending</a></li>',
a+='<li><a style="cursor:pointer;" onclick="ShowPreview('+b.guest.userId+", "+b.guest.spaces+')">Resend Invitation</a></li>'),a+="</ul></div>");a+="</td></tr>"});0==c.items.length&&(a='<tr><td colspan="8">'+c.message+"</td></tr>");$("#declined-count").html(c.spaceCount);$("#declined-tbl").html(a);Pagination(c,"getDeclinedGuestList",$("#declined-pagination"))})}
function getInvitedGuestList(e){var d=new GuestList;d.setPageNumber(e);d.setPostData({attending:"false",itemid:itemId,status:"invited",CSRF_SESSION_TOKEN:CSRF_SESSION_TOKEN});$.when(d.fetch()).then(function(c){var a="";$.each(c.items,function(c,b){a+="<tr><td>"+b.profile.firstname+" "+b.profile.lastname+"</td><td>"+b.reference+"</td><td>"+b.role+'</td><td><a href="mailto:'+b.profile.email+'">'+b.profile.email+'</a></td><td class="hidden-xs">'+b.inviteDate+'</td><td class="hidden-xs">'+b.status+'</td><td class="hidden-xs">'+
b.guest.spaces+'</td><td rowspan="2">';!1===b.userIsDeleted&&(a+='<div class="btn-group pull-right"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">Options <span class="caret"></span></button><ul class="dropdown-menu" role="menu">',a+='<li><a href="/people/viewuser/'+b.guest.userId+'">View profile</a></li>',!1===deniedForActions&&(a+='<li><a style="cursor:pointer;" onclick="AttendGuest('+b.guest.userId+')">Change to Attending</a></li>',a+=
'<li><a style="cursor:pointer;" onclick="DeclineGuest('+b.guest.userId+')">Change to Declined</a></li>',a+='<li><a style="cursor:pointer;" onclick="ShowPreview('+b.guest.userId+", "+b.guest.spaces+')">Resend Invitation</a></li>'),a+="</ul></div>");a+='</td></tr><tr><td colspan="8" style="border-top: none; padding-top: 0;">'+b.invite+"</td></tr>"});0==c.items.length&&(a='<tr><td colspan="8">'+c.message+"</td></tr>");$("#invited-count").html(c.spaceCount);$("#invited-tbl").html(a);Pagination(c,"getInvitedGuestList",
$("#invited-pagination"))})}function DeclineGuest(e){var d=new DeclineGuestListUser;d.setUserId(e);d.setItemId(itemId);$.when(d.fetch()).then(function(c){OutputStatus(c)})}function AttendGuest(e){var d=new AttendGuestListUser;d.setUserId(e);d.setItemId(itemId);$.when(d.fetch()).then(function(c){OutputStatus(c)})}function InviteGuest(e,d){var c=new InviteGuestListUser;c.setUserId(e);c.setItemId(itemId);c.setSpaces(d);c.setSendEmail(!0);$.when(c.fetch()).then(function(a){OutputStatus(a)})}
function ShowPreview(e,d){emailWidget.previewData={event:itemId,emailType:"invitation",user:e};Function.prototype.bind||(Function.prototype.bind=function(c){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var a=Array.prototype.slice.call(arguments,1),d=this,b=function(){},e=function(){return d.apply(this instanceof b&&c?this:c,a.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;e.prototype=new b;return e});
emailWidget.callback=InviteGuest.bind(void 0,e,d);emailWidget.modal.modal("show")}function OutputStatus(e){"success"==e.status?(refreshGuestList(),$("#errorbox").hide(),$("#successbox").stop().fadeOut("fast").fadeIn("fast").html(e.message)):($("#successbox").hide(),$("#errorbox").stop().fadeOut("fast").fadeIn("fast").html(e.message))};
