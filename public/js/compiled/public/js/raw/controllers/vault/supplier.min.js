var search=new SearchVault,guestList=new GetGuestListEvents,geocoder,geocodeResults=null,searchResults=null,resultView="#vaulttiles";function AddCategory(a){var b=$("#category-"+a),c=search.getCategoryId();-1==$.inArray(a,c)?(search.addCategoryId(a),b.removeClass("alert-plain").addClass("alert-success")):(c=$.grep(c,function(b){return b!=a}),search.setCategoryId(c),b.removeClass("alert-success").addClass("alert-plain"))}
function AddCatering(a){var b=$("#catering-"+a),c=search.getCatering();-1==$.inArray(a,c)?(search.addCatering(a),b.removeClass("alert-plain").addClass("alert-success")):(c=$.grep(c,function(b){return b!=a}),search.setCatering(c),b.removeClass("alert-success").addClass("alert-plain"))}
function peopleClearOptions(){search.setAge([]);search.setCategoryId([]);search.setGender([]);$(".age-opt").removeClass("alert-success").addClass("alert-plain");$(".gender-opt").removeClass("alert-success").addClass("alert-plain");$(".interest-opt").removeClass("alert-success").addClass("alert-plain");$("#age-filter").addClass("option-disabled");$("#interests-filter").addClass("option-disabled")}
function peopleEnableOptions(){$("#age-filter").removeClass("option-disabled");$("#interests-filter").removeClass("option-disabled")}function AddAge(a){var b=$("#age-"+a),c=search.getAge();-1==$.inArray(a,c)?(search.addAge(a),b.removeClass("alert-plain").addClass("alert-success")):(c=$.grep(c,function(b){return b!=a}),search.setAge(c),b.removeClass("alert-success").addClass("alert-plain"))}
function AddGender(a){var b=$("#gender-"+a),c=search.getGender();-1==$.inArray(a,c)?(search.addGender(a),b.removeClass("alert-plain").addClass("alert-success")):(c=$.grep(c,function(b){return b!=a}),search.setGender(c),b.removeClass("alert-success").addClass("alert-plain"))}
function AddPrice(a){var b=$("#price-fixed"),c=$("#price-complimentary");b.removeClass("alert-success").addClass("alert-plain");c.removeClass("alert-success").addClass("alert-plain");search.getPrice()!==a||null==search.getPrice()?(search.setPrice(a),$("#price-"+a).removeClass("alert-plain").addClass("alert-success")):search.setPrice(null)}
function AddType(a,b){var c=$("#type-confirmed"),d=$("#type-byarrangement");c.removeClass("alert-success").addClass("alert-plain");d.removeClass("alert-success").addClass("alert-plain");search.getType()!==b||null==search.getType()?(search.setType(b),$("#type-"+a).removeClass("alert-plain").addClass("alert-success")):search.setType(null)}
function AddBrand(a){var b=$("#brand-"+a),c=search.getBrandId();-1==$.inArray(a,c)?(search.addBrandId(a),b.removeClass("alert-plain").addClass("alert-success")):(c=$.grep(c,function(b){return b!=a}),search.setBrandId(c),b.removeClass("alert-success").addClass("alert-plain"))}
$(document).ready(function(){geocoder=new google.maps.Geocoder;var a=null;$.when(guestList.fetch()).then(function(a){guestList=a;GetOrgEvents();GetSelEvents();SearchEvents(1,!0)});$("#postcode").keyup(function(){""!=$(this).val()?($("#apply-filters").prop("disabled",!0),clearTimeout(a),a=setTimeout(function(){getGeolocation()},800)):($("#georesults").empty(),$("#apply-filters").prop("disabled",!1),search.setSearchLatitude(null),search.setSearchLongitude(null))});$("#brands-filter").click(function(){$("#filters-container").fadeIn("fast");
$(".filter-container").hide();$("#brands-container").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")});$("#interests-filter").click(function(){$(this).hasClass("option-disabled")||($("#filters-container").fadeIn("fast"),$(".filter-container").hide(),$("#interests-container").show(),$(".selected-filter").removeClass("selected-filter"),$(this).addClass("selected-filter"))});$("#price-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();
$("#price-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")});$("#type-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#type-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")});$("#gender-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#gender-options").show();$(".selected-filter").removeClass("selected-filter");
$(this).addClass("selected-filter")});$("#age-filter").click(function(){$(this).hasClass("option-disabled")||($("#filters-container").fadeIn("fast"),$(".filter-container").hide(),$("#age-options").show(),$(".selected-filter").removeClass("selected-filter"),$(this).addClass("selected-filter"))});$("#people-filter").click(function(){$("#filters-container").fadeIn("fast");$(".filter-container").hide();$("#people-options").show();$(".selected-filter").removeClass("selected-filter");$(this).addClass("selected-filter")})});
function getBrowserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(geocodeLatLng):alert("Geolocation is not supported by this browser.")}
function getGeolocation(){if(""!=$("#postcode").val()){var a=$("#postcode").val();geocoder.geocode({address:a},function(a,c){c==google.maps.GeocoderStatus.OK?formatGeocodeResults(a):($("#georesults").empty(),$("#georesults").append('<div class="alert alert-warning" role="alert" style="margin-top:5px;">No results were found please refine your search</div>'))})}}
function geocodeLatLng(a){a={lat:parseFloat(a.coords.latitude),lng:parseFloat(a.coords.longitude)};geocoder.geocode({location:a},function(a,c){c===google.maps.GeocoderStatus.OK?($("#apply-filters").prop("disabled",!0),formatGeocodeResults(a)):($("#georesults").empty(),$("#georesults").append('<div class="alert alert-warning" role="alert" style="margin-top:5px;">No results were found please refine your search</div>'))})}
function formatGeocodeResults(a){$("#georesults").empty();var b=0;0<a.length&&(geocodeResults=a,$.each(a,function(a,d){b++;$("#georesults").append('<div class="georesult" onclick="setSearchLocation('+a+')">'+d.formatted_address+"</div>")}),0!=b?$("#georesults").prepend('<p style="margin-top: 15px; font-weight: bold">Please select a location:</p>'):($("#georesults").empty(),$("#georesults").append('<div class="alert alert-warning" role="alert" style="margin-top:5px;">No results were found please refine your search</div>')))}
function setSearchLocation(a){$("#apply-filters").prop("disabled",!1);search.setSearchLatitude(geocodeResults[a].geometry.location.lat());search.setSearchLongitude(geocodeResults[a].geometry.location.lng());$("#postcode").val(geocodeResults[a].formatted_address);$("#georesults").empty()}function displayResults(){var a=$.templates(resultView);$("#all-container").html(a.render(searchResults));BindTiles()}
function GetOrgEvents(){var a=new GetOrganisationEvents;$.when(a.fetch()).then(function(a){if(null!=a.items&&0!=a.items.length){var c=$.templates("#vaultOrganisation");$("#orgcarousel").html(c.render(a));$("#organisation-events").fadeIn("fast")}})}function GetSelEvents(){var a=new GetSelectedEvents;$.when(a.fetch()).then(function(a){if(null!=a.items&&0!=a.items.length){var c=$.templates("#vaultSelected");$("#selectedcarousel").html(c.render(a));$("#selected-events").fadeIn("fast")}})}
function SearchEvents(a,b){$(document.body).animate({scrollTop:$("#main-items").offset().top},500);$("#filter-container").hide();$("#all-container").css("opacity",.5);search.setPageNumber(a);search.setDistance($("#distance").val());search.setOrder($("#order").val());performSearch(b)}
function performSearch(a){$.when(search.fetch()).then(function(b){searchResults=b;$("#all-container").css("opacity",1);0!=b.items.length&&null!=b.items?(displayResults(),$("#all-events").fadeIn("fast"),VaultPagination(b,"SearchEvents",$("#all-pagination"),"vault"),VaultPagination(b,"SearchEvents",$("#all-pagination-bottom"),"vault")):($("#all-pagination").empty(),$("#all-pagination-bottom").empty(),$("#all-container").html('<div class="alert alert-warning" style="margin-bottom: 5px; margin-left:15px; margin-right: 15px;" >'+
b.noitems+"</div>"));!0===a&&(loadFilters(b),a=!1)})}function BindTiles(){$(".item-tile").hover(function(){$(this).find(".item-tile-desc").stop().animate({height:"toggle"},200,function(){})},function(){$(this).find(".item-tile-desc").stop().animate({height:"toggle"},200,function(){})})}function setResultsView(a){resultView=a;displayResults()}
function loadFilters(a){var b=$("#interests-container"),c=$("#brands-container");b.empty();c.empty();a=new getBrands;$.when(a.fetch()).then(function(a){$.each(a,function(a,b){c.append('<div class="col-lg-3 col-md-4 col-md-6"><div class="alert alert-plain alert-thin link" style="margin-bottom: 5px;" onclick="AddBrand('+a+')" id="brand-'+a+'">'+b.name+' <span class="badge pull-right">'+b.items.length+"</div></div>")})});a=new getInterests;$.when(a.fetch()).then(function(a){$.each(a,function(a,c){b.append('<div class="col-lg-3 col-md-4 col-md-6"><div class="alert alert-plain alert-thin link interest-opt" style="margin-bottom: 5px;" id="category-'+
a+'" onclick="AddCategory('+a+')">'+c.name+' <span class="badge pull-right">'+c.items.length+"</span></div></div>")})})};
