var steps=0,stepper=0;function setSteps(a){steps=a;stepper=100/steps}function setStep(a){clearErrors();$(".progress-bar").css("width",stepper*a+"%");$(".step").hide();$("#step-"+a).show()}
function validateStep(a){clearErrors();switch(a){case 1:validatePortal($("#portal-name").val());validateRole($("#role option"));0==errors.length&&initialiseUserLookup($("#role").val(),$("#portal-name").val(),$("#organisationId").val());break;case 2:ValidateUserOwner($("#user-lookup-value").val()),"Client"==$("#role").val()?ValidateReferenceOrName($("#reference-code").val(),$("#firstname").val(),$("#lastname").val()):ValidateFullUser($("#firstname").val(),$("#lastname").val(),$("#emailaddress").val()),
validateTelephoneNumber($("#phone").val())||errors.push("The telephone number can only contain digits"),validateTelephoneNumber($("#mobile").val())||errors.push("The mobile number can only contain digits"),ValidateUserEmailAddress(),ValidateUserDateOfBirth($("#dob-formatted").val())}0==errors.length?setStep(a+1):displayErrors()}function validatePortal(a){"none"==a&&errors.push("You must select a Portal to continue")}
function validateRole(a){0==a.size()&&errors.push("You must select a role to continue or there are is insufficient quota to create a new Person")}function ValidateUserOwner(a){""!=a&&null!=a||errors.push("You must select an owner for this user")}function ValidateFullUser(a,b,c){""!=a&&null!=a||errors.push("You must provide the first name for this user");""!=b&&null!=b||errors.push("You must provide the last name for this user");validateEmail(c)||errors.push("Please enter a valid email address")}
function ValidateReferenceOrName(a,b,c){""!=a||""!=b&&""!=c||errors.push("You must provide either a Reference or a First Name and Last Name")}function ValidateUserEmailAddress(){}function ValidateUserDateOfBirth(a){""!=a&&(a=new moment(a,"DD-MM-YYYY"),a.isValid()?(18>moment().diff(a,"years")||120<moment().diff(a,"years"))&&errors.push("User must be aged 18 or over"):errors.push("Invalid date of birth entered (DD/MM/YYYY)"))}
function getEmailInUse(a,b,c){return $.ajax({url:"/callback/portalEmailInUse",type:"post",dataType:"json",cache:!1,data:{portalId:a,email:b,userId:c}})}function CreateUser(){return $.ajax({url:"/adminusers/ajaxcreateuser",type:"post",dataType:"json",cache:!1,data:$("#user-form").serialize()})};
